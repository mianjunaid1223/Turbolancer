<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=0.97" />
    <title>Profile | {{name.capitalize()}}</title>
    <link rel="icon" type="image/png" href="/static/icon.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/static/profie_page.css" />
    <link rel="stylesheet" href="/static/toast.css" />

    <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.3/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/static/toast.js"></script>
</head>

<body>
    <!-- Navbar -->
    <div class="w-full navbar bg-base-300">
        <div class="flex-1 px-2 mx-2">
            <a id="back" class="btn btn-ghost" href="">
                <i class="fas fa-arrow-left"></i>
            </a>
            <img src="/static/dark_logo.png" alt="TurboLancer" class="logo" />
        </div>
        <div class="flex-none">
            <!-- ADD DROP DOWN HERE -->

            <div class="dropdown dropdown-end">
                <div tabindex="0" class="m-1 btn btn-ghost btn-circle avatar">
                    <div class="w-10 rounded-full">
                        <img src="{{image}}" alt="{{ name.upper() }}" />
                    </div>
                </div>
                <ul tabindex="0"
                    class="menu menu-compact dropdown-content mt-3 p-2 shadow bg-base-100 rounded-box w-52">
                    {% if not x %}
                    <li onclick="details('/create_chat/{{dd}}', true)"><a>Message</a></li>
                    {% else %}
                    <li><a id="LogOutButton">Logout</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="profile-section">
            <div class="profile-header">
                <div class="profile-initials">
                    <img onclick="openit(this)" src="{{image}}" alt="{{ name.upper() }}" />
                </div>
                <div class="profile-info">
                    <h2 class="profile-name">{{ name.upper() }}</h2>
                    {% if x %}
                    <p class="profile-details">
                        {{ email }} , {{ ph }}, <i class="fas ico fa-globe"></i> {{
                        country }}
                    </p>
                    <p class="profile-role" style="color: #00b800; text-decoration: underline">
                        {{ tag }}
                    </p>
                    {% else %}
                    <p class="profile-details">
                        <tag style="color: #00b800; text-decoration: underline">{{ tag }}</tag>
                        , <i class="fas ico fa-globe"></i> {{ country }}
                    </p>
                    {% endif %}
                </div>
            </div>
            <div class="profile-stats stats shadow" style="width: 100%">
                {% if x %}
                <div class="stat">
                    <div class="stat-title">
                        <i class="fas ico fa-dollar-sign"></i>{% if c %} Total Spendings
                        {% else %} Total Earnings {% endif %}
                    </div>
                    <div class="stat-value">
                        ${% if earnings %}{{ earnings | sum }}{% else %}0{% endif %}
                    </div>
                </div>
                {% endif %}
                <div class="stat">
                    <div class="stat-title">
                        <i class="fas ico fa-box"></i> {% if c %}Total Orders {% else %}
                        Total Catalog Items {% endif %}
                    </div>
                    <div class="stat-value">{{ total_catalog_items }}</div>
                </div>
                <div class="stat">
                    <div class="stat-title">
                        <i class="fas ico fa-project-diagram"></i> {% if c %}Total Job
                        Uploads {% else %}Total Projects {% endif %}
                    </div>
                    <div class="stat-value">{{ total_projects }}</div>
                </div>
                {% if not c %}
                <div class="stat">
                    <div class="stat-title">
                        <i class="fas ico fa-star"></i> User Rating
                    </div>
                    <div class="stat-value">{{ rating }}</div>
                </div>
                {% endif %}
            </div>
            <div class="profile-bio mb-3 text-gray-500 dark:text-gray-400" style="margin-left: 3%">
                <p>{{ about_self }}</p>
            </div>
        </div>

        <div class="section-card">
            <div class="profile-stats stats shadow" style="width: 100%">
                <div class="stat">
                    <div class="stat-title">
                        <i class="fas ico fa-calendar-alt"></i> Joined in
                    </div>
                    <div class="stat-value">{{ year }}</div>
                </div>
                <div class="stat">
                    <div class="stat-title">
                        <i class="fas ico fa-cake"></i> Date of Birth
                    </div>
                    <div class="stat-value">{{ bir }}</div>
                </div>
                <div class="stat">
                    <div class="stat-title">
                        <i class="fas ico fa-solid fa-venus-mars"></i> Gander
                    </div>
                    <div class="stat-value">{{ gan }}</div>
                </div>
            </div>
        </div>
        {% if not c %}
        <div class="section-card">
            <h3 class="section-title">
                <i class="fas ico fa-graduation-cap"></i> Skills
                <tag class="stat-title">(Claimed by Seller)</tag>
            </h3>
            {% if sk %} {% for x in sk %}
            <div style="margin-top: 15px">
                <div class="flex justify-between mb-1">
                    <span class="text-base font-medium text-{{x[2]}}-700 light:text-white">{{x[0]}}</span>
                    <span class="text-sm font-medium text-{{x[2]}}-700 light:text-white">{{x[1]}}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5 light:bg-gray-700">
                    <div class="bg-{{x[2]}}-600 h-2.5 rounded-full" style="width: {{x[1]}}%"></div>
                </div>
            </div>
            {% endfor %} {% else %}
            <div class="artboard artboard-horizontal phone-5">Nothing to show!</div>

            {% endif %}
        </div>
        {% endif %}
        <div class="section-card">
            {% if x and not c %}
            <h3 class="section-title">
                <i class="fas ico fa-project-diagram"></i> Your Projects
            </h3>
            {% elif x and c %}
            <h3 class="section-title">
                <i class="fas ico fa-heart"></i> Projects You Liked
            </h3>
            {% elif not x and not c %}
            <h3 class="section-title">
                <i class="fas ico fa-project-diagram"></i> Projects made by
                {{name.upper()}}
            </h3>
            {% endif %}
            <div class="flex gridparent">
                <div class="card bg-base-100 shadow-xl w-80 reqimg" onmouseleave="hide(this)" onmouseenter="show(this)"
                    data-c="320">
                    <div class="after" onclick="next(this)">↪</div>
                    <div class="before" onclick="back(this)">↩</div>
                    <figure class="relative">
                        <div class="slideshow">
                            <img src="/static/4543.png" data-num="1" alt="Product Image"
                                class="rounded-t-box w-full h-48 object-cover" />
                            <!-- Adjusted image size -->
                            <img src="/static/6krbcxk4.png" data-num="2" alt="Product Image"
                                class="rounded-t-box w-full h-48 object-cover" />
                            <!-- Adjusted image size -->
                            <img src="/static/banner.jpg" data-num="3" alt="Product Image"
                                class="rounded-t-box w-full h-48 object-cover" />
                            <!-- Adjusted image size -->
                            <img src="/static/bh.jpg" data-num="3" alt="Product Image"
                                class="rounded-t-box w-full h-48 object-cover" />
                            <!-- Adjusted image size -->
                        </div>
                        <button class="btn btn-circle btn-ghost absolute top-2 right-2 heart" onclick="like(this)">
                            <i class="fa-regular fa-heart" style="color: #d1d1d1"></i>
                            <i class="fa-solid fa-heart text-red-500"></i>
                        </button>
                    </figure>
                    <div class="card-body">
                        <h2 class="card-title">
                            Product Name
                            <div class="badge badge-secondary">NEW</div>
                        </h2>
                        <p class="disc">Product description goes here...</p>
                        <div class="card-actions justify-between">
                            <div class="badge badge-lg">Audio</div>
                            <div class="text-black text-base-200 font-semibold" style="font-size: larger">
                                <bold>$40</bold>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Repeat similar structure for other projects -->
            </div>
        </div>

        <div class="section-card">
            {% if x and not c %}
            <h3 class="section-title">
                <i class="fas ico fa-box"></i> Your Catalogs
            </h3>
            {% elif x and c %}
            <h3 class="section-title">
                <i class="fas ico fa-heart"></i> Catalogs You Liked
            </h3>
            {% elif not x and not c %}
            <h3 class="section-title">
                <i class="fas ico fa-box"></i> Catalogs by {{name.upper()}}
            </h3>
            {% endif %}
            <div class="flex gridparent">
                {% if cat %} {% for item in cat %}
                <div class="card bg-base-100 shadow-xl w-80 reqimg" id="CARD{{ loop.index0 }}" data-p="{{item['_id']}}"
                    onmouseleave="hide(this)" onmouseenter="show(this)" data-c="320">
                    <div class="after" onclick="next(this)">↪</div>
                    <div class="before" onclick="back(this)">↩</div>
                    <figure class="relative">
                        <div class="slideshow">
                            {% for img in item['images'] %}
                            <img src="{{img}}" data-num="{{ loop.index0 }}" alt="Product Image"
                                class="rounded-t-box w-full h-48 object-cover" />
                            {% endfor %}
                        </div>
                        {% if x %}
                        <button class="btn btn-circle btn-ghost absolute top-2 right-2 heart"
                            style="background-color: #404040"
                            onclick="modal('d','Are you sure you want to delete this catalogue?','Yes, I\'m sure','dellit', `CARD{{ loop.index0 }}`),dellit()">
                            <i class="fa-regular fa-trash-can"
                                style="background-color: transparent; color: #ff0000"></i>
                        </button>
                        {% else %}
                        <button class="btn btn-circle btn-ghost absolute top-2 right-2 heart" onclick="like(this)">
                            <i class="fa-regular fa-heart" style="background-color: transparent; color: #e2e2e2"></i>
                            <i class="fa-solid fa-heart text-red-500" style="background-color: transparent"></i>
                        </button>
                        {% endif %}
                    </figure>
                    <div onclick="details('{{c_id[loop.index0]}}')" class="card-body"
                        style="border-radius: 14px; cursor: pointer">
                        <h4 class="card-title" title="{{item['title']}}">
                            <span class="ti" style="font-size: 17px">{{item['title']}}</span>
                            {% if item['res'] %}
                            <sup class="badge badge-secondary">NEW</sup>
                            {% endif %}
                        </h4>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="avatar online">
                                    <div class="w-8 rounded-full">
                                        <img src="{{item['seller_image']}}" />
                                    </div>
                                </div>
                                <span class="ml-2 text-sm font-semibold ti">{{item['seller_name']}}</span>
                            </div>
                        </div>
                        <div class="card-actions justify-between mt-4">
                            <div class="badge badge-lg">{{item['orders']}} orders</div>
                            <div class="text-base-content font-semibold">
                                <span class="text-gray-500">Starting at:</span>
                                <span class="text-lg ti" style="width: 70px">${{item['inputValues'][0]}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %} {% else %}
                <div class="artboard artboard-horizontal phone-5">
                    Nothing to show!
                </div>

                {% endif %}
            </div>
        </div>
        {% if x %}

        <div class="section-card bp flex justify-between">
            <label for="editProfileModal" class="btn bg-green-500 gap-2 action_button">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                </svg>
                Edit profile
            </label>
            <label for="popup-logout" class="btn btn-error gap-2 action_button logout modal-button">
                <i class="fas fa-sign-out-alt"></i> Log Out
            </label>
        </div>
        {% endif %}
    </div>

    {% if x %}

    <!-- Modal -->
    <input type="checkbox" id="editProfileModal" class="modal-toggle" />
    <div class="modal">
        <div class="modal-box relative">
            <label
                onclick="document.querySelector('form').reset();document.getElementById('avatarPreview').src='{{image}}'"
                for="editProfileModal" class="btn btn-sm btn-circle absolute right-2 top-2">✕</label>
            <h3 class="text-lg font-bold">Edit Profile</h3>
            <form>
                <!-- Form fields here -->
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Change Avatar</span>
                    </label>
                    <div class="profile-initials mx-auto mb-3">
                        <img onclick="openit(this)" id="avatarPreview" src="{{image}}" alt="{{ name.upper() }}" />
                    </div>
                    <input type="file" class="file-input file-input-bordered" id="image" accept="image/*"
                        onchange="previewImage(event)" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Edit Name</span>
                    </label>
                    <input type="text" class="input input-bordered" id="name" value="{{name}}" />
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Select Gender</span>
                    </label>
                    <input type="text" class="input input-bordered" list="ganderL" id="gan" value="{{gan}}"
                        name="gan" />
                    <datalist id="ganderL">
                        <option value="Male"></option>
                        <option value="Female"></option>
                        <option value="Other..."></option>
                        <option value="Not interested to tell"></option>
                    </datalist>
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Edit Date of Birth </span>
                    </label>
                    <input type="date" class="input input-bordered" id="bir" value="{{bir}}" />
                </div>
                {% if not c %}

                <div class="form-control">
                    <label class="label">
                        <span class="card-title">Edit Skills Stat
                            <tag class="text-red-700 light:text-white">(Max 6)</tag>
                        </span>
                    </label>
                    {% if sk %} {% for x in sk %}

                    <div style="margin-top: 15px">
                        <div class="flex justify-between mb-1">
                            <label for="popup-modal" data-skill="{{x[0]}}" onclick="transfer(this)"
                                class="btn modal-button text-red-500" style="
                    background-color: transparent;
                    border: none;
                    text-decoration: underline;
                  ">
                                <i class="fas fa-trash"></i>&nbsp;
                                <span class="text-base font-medium">{{x[0]}}</span>
                            </label>

                            <span class="text-sm font-medium text-{{x[2]}}-700 light:text-white"
                                id="percent">{{x[1]}}%</span>
                        </div>
                        <input type="range" data-skill="{{x[0]}}" oninput="update_live(this)" min="0" max="100" id="sk"
                            value="{{x[1]}}" class="range range-xs" />
                    </div>
                    {% endfor %} {%if len < 6%} <label type="button" class="btn action_button"
                        onclick="addElement(this)" style="width: 100%">Add skill</label>
                        {% endif %} {% else %}
                        <label type="button" class="btn action_button" onclick="addElement(this)"
                            style="width: 100%">Add skill</label>

                        {% endif %}
                </div>
                <div class="form-control">
                    <div class="container mx-auto">
                        <div class="form-control w-full">
                            <label class="label">
                                <span class="label-text">About Yourself</span>
                            </label>
                            <textarea oninput="initializeTextarea()" class="textarea textarea-bordered h-48 max-w-full"
                                id="about_self" name="about-yourself" maxlength="500"
                                placeholder="Ensure the text exceeds 250 characters for a stronger impact." required>
{{about_self}}</textarea>
                            <label class="label">
                                <span class="label-text-alt">Characters: <span class="charcount"></span></span>
                                <span class="label-text-alt">Remaining: <span class="remaining"></span></span>
                                <span class="label-text-alt text-error less" style="display: none">Less than 250</span>
                            </label>
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="modal-action">
                    <button type="submit"  class="btn bg-green-500 submitbtn">
                        Save
                        Changes</span>
                    </button>
                    <label for="editProfileModal" class="btn"
                        onclick="document.querySelector('form').reset();document.getElementById('avatarPreview').src='{{image}}'">Cancel</label>
                </div>
            </form>
        </div>
    </div>
    {% endif %}

    <input type="checkbox" id="popup-modal" class="modal-toggle" />
    <div class="modal modal-bottom sm:modal-middle">
        <div class="modal-box relative">
            <label for="popup-modal" class="btn btn-sm btn-circle absolute right-2 top-2">✕</label>
            <div class="py-4 text-center">
                <svg class="mx-auto mb-4 w-12 h-12 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                <h3 class="text-lg font-normal text-base-content">
                    Are you sure you want to delete this Item?
                </h3>
                <div class="mt-6 flex justify-center space-x-4">
                    <label for="popup-modal" class="btn bg-error logout" id="dellitem" onclick="delitem(this)">Yes, I'm
                        sure</label>
                    <label for="popup-modal" class="btn btn-outline">No, cancel</label>
                </div>
            </div>
        </div>
    </div>

    <input type="checkbox" id="popup-logout" class="modal-toggle" />
    <div class="modal modal-bottom sm:modal-middle">
        <div class="modal-box relative">
            <label for="popup-logout" class="btn btn-sm btn-circle absolute right-2 top-2">✕</label>
            <div class="py-4 text-center">
                <svg class="mx-auto mb-4 w-12 h-12 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 20 20">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 11V6m0 8h.01M19 10a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                <h3 class="text-lg font-normal text-base-content">
                    Are you sure you want to LogOut?
                </h3>
                <div class="mt-6 flex justify-center space-x-4">
                    <label for="popup-logout" class="btn bg-error logout" id="LogOutButton">Yes, I'm sure</label>
                    <label for="popup-logout" class="btn btn-outline">No, cancel</label>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>

    <script>
        "{% if x %}";

        function dellit() {
            document.querySelector("#dellit").addEventListener("click", () => {
                const element = document
                    .querySelector("#dellit")
                    .getAttribute("data-given");
                const pId = document
                    .querySelector(`#${element}`)
                    .getAttribute("data-p");
                console.log(pId);
                data_tobe_tranfer = new FormData();
                data_tobe_tranfer.append("id", pId);
                fetch("/dell_catalogue", {
                    method: "POST",
                    body: data_tobe_tranfer,
                })
                    .then((response) => response.json())
                    .then((data) => {
                        toast("s", "Successfully Deleted");
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    })
                    .catch((error) => {
                        toast("d", "An error occurred");
                    });
            });
        }
        function addElement(button) {
            const element = document.createElement("div");
            element.style.marginTop = "15px";
            element.id = "newproduct";
            randomDigitString = generateRandomDigitString();
            element.insertAdjacentHTML(
                "beforeend",
                `
    <div class="flex justify-between mb-1">
      <span class="text-base font-medium text-gray-700 light:text-white" style="padding: 3px;border: solid 1px #4b4b4b; border-radius: 5px;outline: none;" oninput='changedata(this),changeprev(this)' data-prev='Click Here Provide Name' data-inputclass = '${randomDigitString}' contenteditable='true'>Click Here Provide Name</span>
      <span class="text-sm font-medium text-gray-700 light:text-white" id="percent">0%</span>
    </div>
    <input type="range" id="sk" data-skill='Click Here Provide Name'  oninput="update_live(this)" min="0" max="100"  value="0" class="range range-xs ${randomDigitString}"  />
  `
            );

            button.parentNode.insertBefore(element, button);
            button.remove();
            setupElement(randomDigitString);
        }

        function generateRandomDigitString() {
            let randomDigitString = "";
            const digits = "qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM";

            // Generate 10 random digits
            for (let i = 0; i < 10; i++) {
                const randomIndex = Math.floor(Math.random() * digits.length);
                randomDigitString += digits[randomIndex];
            }

            return randomDigitString;
        }
        function changedata(x) {
            const inputElement = x.getAttribute("data-inputclass");
            console.log(`this is ${inputElement}`)
            console.log(`and ${ document.querySelector(`.${inputElement}`)}`)
            document
                .querySelector(`.${inputElement}`)
                .setAttribute("data-skill", x.innerText);
        }

        function update_live(x) {
            x.parentElement.querySelector("#percent").innerText = x.value + "%";
            let color;
            if (parseInt(x.value) < 50) {
                color = "gray";
            } else if (parseInt(x.value) >= 50 && parseInt(x.value) < 85) {
                color = "blue";
            } else {
                color = "green";
            }
            x.style.accentColor = color;
        }
        const queryString = window.location.search;
        if (queryString) {
            const urlParams = new URLSearchParams(queryString);
            if (urlParams) {
                const userParam = urlParams.get("referrer");

                if (userParam) {
                    decoded = atob(userParam);
                    document.querySelector("#back").href = decodeURIComponent(decoded);
                } else {
                    document.querySelector("#back").href = "/";
                }
            } else {
                document.querySelector("#back").href = "/";
            }
        } else {
            document.querySelector("#back").href = "/";
        }

        const form = document.querySelector("form");
        const initialValues = {};
        const changedFields = { sk: [] };

        Array.from(form.elements).forEach((field) => {
            if (
                field.tagName.toLowerCase() === "input" ||
                field.tagName.toLowerCase() === "textarea" ||
                field.tagName.toLowerCase() === "select"
            ) {
                initialValues[field.id] = field.value;
                // Add event listener to input elements
                if (
                    field.tagName.toLowerCase() === "input" ||
                    field.tagName.toLowerCase() === "textarea"
                ) {
                    field.addEventListener("input", handleInputChange);
                } else if (field.tagName.toLowerCase() === "select") {
                    field.addEventListener("change", handleInputChange);
                }
            }
        });
        function setupElement(elementId) {
            element = document.querySelector(`.${elementId}`);
            console.log("done");
            element.addEventListener("input", handleInputChange);
        }
        function changeprev(x) {
            console.log(x)
            const prevdata = x.getAttribute("data-prev");
            console.log(prevdata)
            if (prevdata && changedFields["sk"].length > 0) {
                for (i = 0; i <= changedFields["sk"].length; i++) {
                    if (
                        changedFields["sk"][i][0] === prevdata ||
                        changedFields["sk"][i][0] === ""
                    ) {
                        changedFields["sk"][i][0] = x.innerText;

                    }
                }
            }
            x.setAttribute("data-prev", x.innerText);
            console.log("changed");
        }

        function handleInputChange(event) {
            const target = event.target;
            console.log(target);
            if (target.type === "file") {
                handleFileChange(target);
            } else if (target.id === "sk") {
                console.log("yes it is sk");

                const skill = target.getAttribute("data-skill");
                let color;
                if (parseInt(target.value) < 50) {
                    color = "gray";
                } else if (
                    parseInt(target.value) >= 50 &&
                    parseInt(target.value) < 85
                ) {
                    color = "blue";
                } else {
                    color = "green";
                }

                const skillData = [skill, parseInt(target.value), color]; // Convert value to integer
                console.log(skill);
                console.log(parseInt(target.value));
                console.log(color);
                console.log(skillData);
                const existingSkillIndex = changedFields["sk"].findIndex(
                    (sk) => sk[0] === skill
                );
                if (existingSkillIndex !== -1) {
                    changedFields["sk"][existingSkillIndex] = skillData;
                } else {
                    changedFields["sk"].push(skillData);
                }
                console.log(changedFields);
            } else if (target.value !== initialValues[target.id]) {
                changedFields[target.id] = target.value;
            } else {
                delete changedFields[target.id];
            }
        }

        function handleFileChange(fileInput) {
            if (fileInput.files.length > 0) {
                changedFields[fileInput.id] = fileInput.files[0];
            } else {
                delete changedFields[fileInput.id];
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
    const submitBtn = document.querySelector(".submitbtn");
    if (submitBtn) {
        submitBtn.addEventListener('click', function(event) {
            console.log("Submit button clicked");
            submit(event);
        });
    }
});

function submit(event) {
    console.log("Submit function called");
    event.preventDefault(); // Prevent default form submission
    btn = document.querySelector(".submitbtn");
    update(changedFields);
    console.log("Changed fields:", changedFields);
}

        function previewImage(event) {
            var input = event.target;
            var reader = new FileReader();
            reader.onload = function () {
                var avatarPreview = document.getElementById("avatarPreview");
                avatarPreview.src = reader.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
        function update(dataInput) {
            const formData = new FormData();

            for (const [key, value] of Object.entries(dataInput)) {
                if (value instanceof File) {
                    formData.append(key, value);
                } else {
                    formData.append(key, value);
                }
            }
            console.log(formData);
            fetch("/update_profile", {
                method: "POST",
                body: formData,
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then((data) => {
                    toast("s", "Successfully updated your profile.");
                    btn = document.querySelector(".submitbtn");

           
                    setTimeout(() => {
                        console.log('hi')
                        window.location.reload();
                    }, 1000);
                })
                .catch((error) => {
                    toast("d", "An Error occurred.");
                    btn = document.querySelector(".submitbtn");


                    console.error("Error:", error);
                });
        }

        function _(cookieName) {
            var expirationDate = new Date(0); // Create a Date object set to the epoch time (January 1, 1970)
            var formattedDate = expirationDate.toUTCString(); // Get the UTC string representation of the date

            document.cookie = `${cookieName}=; expires=${formattedDate}; path=/;`;
        }
        document
            .getElementById("LogOutButton")
            .addEventListener("click", function () {
                list = ["ideo", "emalo", "deno", "tp"];
                for (i = 0; i <= list.length; i++) {
                    _(list[i]);
                }
                window.location.reload();
            });

        window.addEventListener("beforeunload", () => {
            sessionStorage.setItem("prevUrl", window.location.href);
        });
        ("{% endif %}");
        const SLIDE_WIDTH = 320;
        const TRANSITION_DURATION = 100; // in milliseconds

        function show(container) {
            const afterElement = container.querySelector(".after");
            const beforeElement = container.querySelector(".before");
            const imgElements = container.querySelectorAll("img");
            const imageCount = imgElements.length;

            // Show the before and after elements
            afterElement.style.display = "flex";
            beforeElement.style.display = "flex";

            // Add a delay for the transition effect
            setTimeout(() => {
                afterElement.classList.add("show");
                beforeElement.classList.add("show");
            }, TRANSITION_DURATION);

            // Set data attributes for each image
            imgElements.forEach((img, index) => {
                img.setAttribute("data-num", index);
            });

            container.setAttribute("data-count", imageCount);
        }

        function hide(container) {
            const afterElement = container.querySelector(".after");
            const beforeElement = container.querySelector(".before");

            // Hide the before and after elements
            afterElement.classList.remove("show");
            beforeElement.classList.remove("show");

            // Add a delay for the transition effect
            setTimeout(() => {
                afterElement.style.display = "none";
                beforeElement.style.display = "none";
            }, TRANSITION_DURATION);
        }

        function scrollHorizontalByPixels(element, scrollAmount) {
            if (element) {
                element.scrollLeft += scrollAmount;
            }
        }

        function next(button) {
            const parent = button.parentElement;

            const container = parent;
            show(container);

            let currentOffset = parseInt(parent.getAttribute("data-c"), 10) || 0;
            const slideshow = parent.querySelector(".slideshow");
            const imageCount = parseInt(parent.getAttribute("data-count"), 10);

            if (currentOffset === imageCount * SLIDE_WIDTH) {
                // If at the end of the slideshow, scroll back to the beginning
                scrollHorizontalByPixels(slideshow, -currentOffset);
                parent.setAttribute("data-c", 0);
            } else {
                // Otherwise, scroll to the next slide
                scrollHorizontalByPixels(slideshow, SLIDE_WIDTH);
                currentOffset += SLIDE_WIDTH;
                parent.setAttribute("data-c", currentOffset);
            }
        }

        function back(button) {
            const parent = button.parentElement;

            const container = parent;
            show(container);

            let currentOffset = parseInt(parent.getAttribute("data-c"), 10) || 0;
            const slideshow = parent.querySelector(".slideshow");

            if (currentOffset === 0) {
                // If at the beginning of the slideshow, scroll to the end
                const lastOffset =
                    (parseInt(parent.getAttribute("data-count"), 10) - 1) * SLIDE_WIDTH;
                scrollHorizontalByPixels(slideshow, lastOffset);
                parent.setAttribute("data-c", lastOffset);
            } else {
                // Otherwise, scroll to the previous slide
                scrollHorizontalByPixels(slideshow, -SLIDE_WIDTH);
                currentOffset -= SLIDE_WIDTH;
                parent.setAttribute("data-c", currentOffset);
            }
        }
        const clickDelays = new WeakMap();
        const clickCounts = new WeakMap();
        const maxClicks = 2;
        const delay = 1000;

        function like(button) {
            if (!clickDelays.has(button)) {
                clickDelays.set(button, 0);
                clickCounts.set(button, 0);
            }

            const lastClickTime = clickDelays.get(button);
            const currentTime = new Date().getTime();
            const elapsedTime = currentTime - lastClickTime;
            let clickCount = clickCounts.get(button);

            if (elapsedTime >= delay && clickCount < maxClicks) {
                button.classList.toggle("liked");
                clickCount++;
                clickCounts.set(button, clickCount);
                clickDelays.set(button, currentTime);
            }

            if (clickCount === maxClicks) {
                // Reset the click count after reaching the maximum limit
                clickCounts.set(button, 0);
            }
        }

        ("{% if x %}");
        // Utility function to update the submit button status
        function setSubmitBtnDisabledStatus(isDisabled) {
            const submitBtn = document.querySelector(".submit-btn");
            if (submitBtn) {
                submitBtn.disabled = isDisabled;
            }
        }

        // Function to check if the textarea value exceeds the maximum length
        function checkOverLimit(textarea, maxLength) {
            const charCount = textarea.value.length;
            const charCountElement = document.querySelector(".charcount");
            const remainingElement = document.querySelector(".remaining");
            const remainingLabel = document.querySelector(".remaining");
            const lessLabel = document.querySelector(".less");

            charCountElement.innerHTML = `${charCount}/${maxLength}`;
            const remainingChars = maxLength - charCount;
            remainingElement.innerHTML = Math.abs(remainingChars);

            if (charCount > maxLength) {
                remainingLabel.classList.add("over");
                remainingLabel.innerHTML = "exceeded by:";
                remainingElement.classList.add("over");
                textarea.style.color = "hsl(0, 80%, 60%)";
                textarea.setAttribute("data-over", "true");
                setSubmitBtnDisabledStatus(true);
                lessLabel.style.display = "none";
            } else if (charCount < 250) {
                remainingLabel.classList.remove("over");
                remainingLabel.innerHTML = "Remaining:";
                remainingElement.classList.remove("over");
                textarea.style.color = "hsl(0, 80%, 60%)";
                textarea.setAttribute("data-over", "false");
                setSubmitBtnDisabledStatus(false);
                lessLabel.style.display = "block";
            } else {
                remainingLabel.innerHTML = "Remaining:";
                remainingElement.classList.remove("over");
                textarea.style.color = "hsl(0, 0%, 50%)";
                textarea.setAttribute("data-over", "false");
                setSubmitBtnDisabledStatus(false);
                lessLabel.style.display = "none";
            }
        }

        // Function to initialize the textarea
        function initializeTextarea() {
            const textarea = document.querySelector(".textarea");
            if (!textarea) return;

            const maxLength = parseInt(textarea.getAttribute("maxlength"), 10);
            const charCount = textarea.value.length;
            const charCountElement = document.querySelector(".charcount");
            const remainingElement = document.querySelector(".remaining");

            charCountElement.innerHTML = `${charCount}/${maxLength}`;
            remainingElement.innerHTML = maxLength - charCount;

            checkOverLimit(textarea, maxLength);

            textarea.addEventListener("input", () => {
                checkOverLimit(textarea, maxLength);
            });
        }

        initializeTextarea();

        // Function to transfer data attribute value
        function transfer(element) {
            const button = document.querySelector("#dellitem");
            if (button) {
                const name = element.getAttribute("data-skill");
                button.setAttribute("data-skill", name);
                console.log("transfer done");
            }
        }

        // Function to delete an item
        function delitem(element) {
            const skillName = element.getAttribute("data-skill");
            console.log(skillName);

            const formData = new FormData();
            formData.append("sk", skillName);

            fetch("/delItem", {
                method: "POST",
                body: formData,
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then((data) => {
                    toast("s", "Item deleted Successfully");
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                })
                .catch((error) => {
                    toast("d", "An Error occurred.");
                    console.error("Error:", error);
                });
        }
        ("{% endif %}");

        function place(x) {
            const queryString = window.location.search;

            if (queryString) {
                const urlParams = new URLSearchParams(queryString);
                const userParam = urlParams.get("here");

                if (userParam) {
                    details(x);
                } else {
                    const channel = new BroadcastChannel("live.TurboLancer");
                    channel.postMessage(x);
                }
            } else {
                const channel = new BroadcastChannel("live.TurboLancer");
                channel.postMessage(x);
            }
        }
    </script>
</body>

</html>